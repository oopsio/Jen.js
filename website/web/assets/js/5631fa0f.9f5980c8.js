"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[4119],{6145(e,n,i){i.d(n,{R:()=>l,x:()=>d});var t=i(7140);const s={},r=t.createContext(s);function l(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),t.createElement(r.Provider,{value:n},e.children)}},7252(e,n,i){i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>u,frontMatter:()=>l,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"native-modules","title":"Native Modules","description":"Use high-performance native modules for CPU-intensive tasks.","source":"@site/docs/native-modules.md","sourceDirName":".","slug":"/native-modules","permalink":"/docs/native-modules","draft":false,"unlisted":false,"editUrl":"https://github.com/kessud2021/Jen.js/tree/main/website/docs/native-modules.md","tags":[],"version":"current","sidebarPosition":16,"frontMatter":{"sidebar_position":16},"sidebar":"docs","previous":{"title":"Deployment","permalink":"/docs/deployment"},"next":{"title":"Performance Optimization","permalink":"/docs/performance"}}');var s=i(5656),r=i(6145);const l={sidebar_position:16},d="Native Modules",o={},a=[{value:"Native Module System",id:"native-module-system",level:2},{value:"Available Native Modules",id:"available-native-modules",level:3},{value:"Development Mode",id:"development-mode",level:2},{value:"Production Mode",id:"production-mode",level:2},{value:"Using Pre-built Binaries",id:"using-pre-built-binaries",level:3},{value:"Compiling from Source",id:"compiling-from-source",level:3},{value:"Using Native Modules",id:"using-native-modules",level:2},{value:"Native Bundler",id:"native-bundler",level:2},{value:"Native Style Compiler",id:"native-style-compiler",level:2},{value:"Native Optimizer",id:"native-optimizer",level:2},{value:"Creating Custom Native Modules",id:"creating-custom-native-modules",level:2},{value:"Performance Benefits",id:"performance-benefits",level:2},{value:"Bundling",id:"bundling",level:3},{value:"Style Compilation",id:"style-compilation",level:3},{value:"FFI (Foreign Function Interface)",id:"ffi-foreign-function-interface",level:2},{value:"Node-ffi Pattern",id:"node-ffi-pattern",level:2},{value:"WASM Integration",id:"wasm-integration",level:2},{value:"Conditional Compilation",id:"conditional-compilation",level:2},{value:"Performance Profiling",id:"performance-profiling",level:2},{value:"Debugging Native Code",id:"debugging-native-code",level:2},{value:"Rust Debugging",id:"rust-debugging",level:3},{value:"LLDB Commands",id:"lldb-commands",level:3},{value:"Deployment Considerations",id:"deployment-considerations",level:2},{value:"Binary Compatibility",id:"binary-compatibility",level:3},{value:"Package Distribution",id:"package-distribution",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Next Steps",id:"next-steps",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"native-modules",children:"Native Modules"})}),"\n",(0,s.jsx)(n.p,{children:"Use high-performance native modules for CPU-intensive tasks."}),"\n",(0,s.jsx)(n.h2,{id:"native-module-system",children:"Native Module System"}),"\n",(0,s.jsx)(n.p,{children:"Jen.js has stubs for native modules in TypeScript. In production, replace with Rust/C++ implementations."}),"\n",(0,s.jsx)(n.h3,{id:"available-native-modules",children:"Available Native Modules"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Module"}),(0,s.jsx)(n.th,{children:"TypeScript Stub"}),(0,s.jsx)(n.th,{children:"Production"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"dev-server.ts"})}),(0,s.jsx)(n.td,{children:"Node.js"}),(0,s.jsx)(n.td,{children:"Rust (Tokio)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"bundler.ts"})}),(0,s.jsx)(n.td,{children:"esbuild wrapper"}),(0,s.jsx)(n.td,{children:"C++"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"style-compiler.ts"})}),(0,s.jsx)(n.td,{children:"Stub"}),(0,s.jsx)(n.td,{children:"Rust (sass)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"optimizer.ts"})}),(0,s.jsx)(n.td,{children:"Stub"}),(0,s.jsx)(n.td,{children:"Rust"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"development-mode",children:"Development Mode"}),"\n",(0,s.jsx)(n.p,{children:"During development, TypeScript stubs run on Node.js:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// src/native/dev-server.ts\n\nimport { createServer } from 'node:http';\n\nexport async function startServer(options: ServerOptions) {\n  const server = createServer((req, res) => {\n    // Handle requests...\n  });\n  \n  server.listen(options.port);\n  console.log(`Server on port ${options.port}`);\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"production-mode",children:"Production Mode"}),"\n",(0,s.jsx)(n.p,{children:"In production, compile to native code:"}),"\n",(0,s.jsx)(n.h3,{id:"using-pre-built-binaries",children:"Using Pre-built Binaries"}),"\n",(0,s.jsx)(n.p,{children:"Download compiled binaries and replace stubs:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Get native modules\nnpm install @jen/native-modules\n\n# Binaries are linked automatically\nnpm run build\n"})}),"\n",(0,s.jsx)(n.h3,{id:"compiling-from-source",children:"Compiling from Source"}),"\n",(0,s.jsx)(n.p,{children:"Build Rust modules for your platform:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Install Rust\ncurl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh\n\n# Navigate to native module\ncd src/native\n\n# Build\ncargo build --release\n\n# Output: target/release/native.node\n"})}),"\n",(0,s.jsx)(n.h2,{id:"using-native-modules",children:"Using Native Modules"}),"\n",(0,s.jsxs)(n.p,{children:["Import from ",(0,s.jsx)(n.code,{children:"@src/native/"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { startServer } from '@src/native/dev-server';\nimport { bundle } from '@src/native/bundler';\nimport { compileStyles } from '@src/native/style-compiler';\nimport { optimize } from '@src/native/optimizer';\n\n// Use like normal TypeScript\nawait startServer({ port: 3000 });\nconst output = await bundle('src/index.ts');\n"})}),"\n",(0,s.jsx)(n.p,{children:"The same import works in both development and production!"}),"\n",(0,s.jsx)(n.h2,{id:"native-bundler",children:"Native Bundler"}),"\n",(0,s.jsx)(n.p,{children:"High-performance asset bundling:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { bundle } from '@src/native/bundler';\n\nconst result = await bundle({\n  entryPoints: ['src/index.ts'],\n  outdir: 'dist',\n  minify: true,\n  sourcemap: false,\n  target: 'es2022'\n});\n\nconsole.log(`Bundle size: ${result.size} bytes`);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"native-style-compiler",children:"Native Style Compiler"}),"\n",(0,s.jsx)(n.p,{children:"Fast CSS compilation:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { compileStyles } from '@src/native/style-compiler';\n\nconst result = await compileStyles({\n  input: 'styles/main.scss',\n  output: 'dist/style.css',\n  minify: true\n});\n\nconsole.log(result.css);  // Compiled CSS\n"})}),"\n",(0,s.jsx)(n.h2,{id:"native-optimizer",children:"Native Optimizer"}),"\n",(0,s.jsx)(n.p,{children:"Optimize compiled code:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { optimize } from '@src/native/optimizer';\n\nconst result = await optimize({\n  file: 'dist/bundle.js',\n  removeUnused: true,\n  mangleNames: true\n});\n\nconsole.log(`Optimized: ${result.size} bytes`);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"creating-custom-native-modules",children:"Creating Custom Native Modules"}),"\n",(0,s.jsx)(n.p,{children:"Create a new native module:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"mkdir -p src/native/custom\ncd src/native/custom\ncargo init --lib\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Edit ",(0,s.jsx)(n.code,{children:"Cargo.toml"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-toml",children:'[package]\nname = "jen-custom"\nversion = "0.1.0"\nedition = "2021"\n\n[dependencies]\nneon = "1.0"\ntokio = { version = "1", features = ["full"] }\n\n[lib]\ncrate-type = ["cdylib"]\n'})}),"\n",(0,s.jsx)(n.p,{children:"Write Rust code:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'// src/native/custom/src/lib.rs\n\nuse neon::prelude::*;\n\nfn hello(mut cx: FunctionContext) -> JsResult<JsString> {\n  Ok(cx.string("Hello from Rust!"))\n}\n\n#[neon::main]\nfn main(mut cx: ModuleContext) -> NjsResult<()> {\n  cx.export_function("hello", hello)?;\n  Ok(())\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Create TypeScript stub:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// src/native/custom.ts\n\nexport async function hello(): Promise<string> {\n  // Development stub - returns synchronously\n  return 'Hello from Rust!';\n}\n\n// In production, this imports the native module:\n// import * as custom from '../native/custom/index.node';\n"})}),"\n",(0,s.jsx)(n.p,{children:"Compile and use:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cd src/native/custom\ncargo build --release\n"})}),"\n",(0,s.jsx)(n.p,{children:"Import and use:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { hello } from '@src/native/custom';\n\nconst result = await hello();\nconsole.log(result);  // \"Hello from Rust!\"\n"})}),"\n",(0,s.jsx)(n.h2,{id:"performance-benefits",children:"Performance Benefits"}),"\n",(0,s.jsx)(n.p,{children:"Native modules provide significant speedup:"}),"\n",(0,s.jsx)(n.h3,{id:"bundling",children:"Bundling"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Operation"}),(0,s.jsx)(n.th,{children:"TypeScript"}),(0,s.jsx)(n.th,{children:"Native"}),(0,s.jsx)(n.th,{children:"Speedup"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"100 files"}),(0,s.jsx)(n.td,{children:"5.2s"}),(0,s.jsx)(n.td,{children:"0.8s"}),(0,s.jsx)(n.td,{children:"6.5x"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"1000 files"}),(0,s.jsx)(n.td,{children:"52s"}),(0,s.jsx)(n.td,{children:"4.1s"}),(0,s.jsx)(n.td,{children:"12.7x"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Minify"}),(0,s.jsx)(n.td,{children:"2.3s"}),(0,s.jsx)(n.td,{children:"0.3s"}),(0,s.jsx)(n.td,{children:"7.7x"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"style-compilation",children:"Style Compilation"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Task"}),(0,s.jsx)(n.th,{children:"Node.js"}),(0,s.jsx)(n.th,{children:"Rust"}),(0,s.jsx)(n.th,{children:"Speedup"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Parse SCSS"}),(0,s.jsx)(n.td,{children:"1.2s"}),(0,s.jsx)(n.td,{children:"0.1s"}),(0,s.jsx)(n.td,{children:"12x"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Compile"}),(0,s.jsx)(n.td,{children:"3.4s"}),(0,s.jsx)(n.td,{children:"0.4s"}),(0,s.jsx)(n.td,{children:"8.5x"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Minify"}),(0,s.jsx)(n.td,{children:"0.8s"}),(0,s.jsx)(n.td,{children:"0.05s"}),(0,s.jsx)(n.td,{children:"16x"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"ffi-foreign-function-interface",children:"FFI (Foreign Function Interface)"}),"\n",(0,s.jsx)(n.p,{children:"Call native code directly:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { createRequire } from 'node:module';\n\nconst native = createRequire(import.meta.url)(\n  '../native/custom/index.node'\n);\n\n// Call native functions\nconst result = native.hello();\n"})}),"\n",(0,s.jsx)(n.h2,{id:"node-ffi-pattern",children:"Node-ffi Pattern"}),"\n",(0,s.jsx)(n.p,{children:"Use node-ffi for C/C++ libraries:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import ffi from 'ffi-napi';\nimport { Library, DataType } from 'ffi-napi';\n\n// Load native library\nconst lib = new Library('mylib', {\n  add: [DataType.int32, [DataType.int32, DataType.int32]],\n  process: [DataType.void, [DataType.string]]\n});\n\nconst sum = lib.add(5, 3);  // Returns 8\n"})}),"\n",(0,s.jsx)(n.h2,{id:"wasm-integration",children:"WASM Integration"}),"\n",(0,s.jsx)(n.p,{children:"Use WebAssembly for browser performance:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// site/components/Calculator.tsx\n\nimport { wasmModule } from '@src/native/calc.wasm';\n\nexport default function Calculator() {\n  const result = wasmModule.add(5, 3);  // 8\n  \n  return <div>Result: {result}</div>;\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"conditional-compilation",children:"Conditional Compilation"}),"\n",(0,s.jsx)(n.p,{children:"Use native modules conditionally:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Automatically select implementation\nlet bundler: any;\n\nif (process.env.USE_NATIVE === 'true') {\n  bundler = await import('@src/native/bundler');\n} else {\n  bundler = await import('@src/bundler-js');\n}\n\nconst result = await bundler.bundle({ /* ... */ });\n"})}),"\n",(0,s.jsx)(n.h2,{id:"performance-profiling",children:"Performance Profiling"}),"\n",(0,s.jsx)(n.p,{children:"Profile native module performance:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { performance } from 'node:perf_hooks';\n\nconst start = performance.now();\n\nconst result = await optimize({\n  file: 'dist/bundle.js',\n  removeUnused: true\n});\n\nconst duration = performance.now() - start;\nconsole.log(`Optimization took ${duration.toFixed(2)}ms`);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"debugging-native-code",children:"Debugging Native Code"}),"\n",(0,s.jsx)(n.h3,{id:"rust-debugging",children:"Rust Debugging"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# With debug symbols\ncargo build\n\n# Attach debugger\nlldb target/debug/custom.node\n"})}),"\n",(0,s.jsx)(n.h3,{id:"lldb-commands",children:"LLDB Commands"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Set breakpoint\n(lldb) b src/lib.rs:10\n\n# Run\n(lldb) run\n\n# Step through\n(lldb) s\n(lldb) n\n"})}),"\n",(0,s.jsx)(n.h2,{id:"deployment-considerations",children:"Deployment Considerations"}),"\n",(0,s.jsx)(n.h3,{id:"binary-compatibility",children:"Binary Compatibility"}),"\n",(0,s.jsx)(n.p,{children:"Native modules must match target platform:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# macOS (Intel)\ncargo build --target x86_64-apple-darwin\n\n# macOS (Apple Silicon)\ncargo build --target aarch64-apple-darwin\n\n# Linux\ncargo build --target x86_64-unknown-linux-gnu\n\n# Windows\ncargo build --target x86_64-pc-windows-gnu\n"})}),"\n",(0,s.jsx)(n.h3,{id:"package-distribution",children:"Package Distribution"}),"\n",(0,s.jsx)(n.p,{children:"Include binaries in npm package:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "name": "@jen/native-bundler",\n  "binary": {\n    "module_name": "bundler",\n    "module_path": "./native/{platform}/{arch}/",\n    "host": "https://github.com/owner/repo",\n    "remote_path": "v{version}/native/",\n    "package_name": "{module_name}-{platform}-{arch}.tar.gz"\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Profile before optimizing"})," - Measure actual bottlenecks"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Use for CPU-intensive tasks"})," - Not I/O operations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Keep TypeScript stubs"})," - For development compatibility"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Document thoroughly"})," - Explain native behavior"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Test on target platforms"})," - Ensure compatibility"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Monitor performance"})," - Track real-world impact"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Keep native code simple"})," - Minimize maintenance burden"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Use established libraries"})," - Don't rewrite the wheel"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"./performance",children:"Performance"})," - Optimize your site"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"./build",children:"Build"})," - Build system overview"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"./deployment",children:"Deployment"})," - Deploy native modules"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}}}]);