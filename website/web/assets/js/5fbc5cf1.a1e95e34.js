"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[7624],{420(e,n,s){s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"api","title":"API Routes","description":"Build REST APIs with Jen.js API routes.","source":"@site/docs/api.md","sourceDirName":".","slug":"/api","permalink":"/docs/api","draft":false,"unlisted":false,"editUrl":"https://github.com/kessud2021/Jen.js/tree/main/website/docs/api.md","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8},"sidebar":"docs","previous":{"title":"Data Loading","permalink":"/docs/data-loading"},"next":{"title":"Database","permalink":"/docs/database"}}');var t=s(5656),i=s(6145);const a={sidebar_position:8},o="API Routes",d={},c=[{value:"Creating API Routes",id:"creating-api-routes",level:2},{value:"Basic API Route",id:"basic-api-route",level:2},{value:"HTTP Methods",id:"http-methods",level:2},{value:"Query Parameters",id:"query-parameters",level:2},{value:"Route Parameters",id:"route-parameters",level:2},{value:"Request Body",id:"request-body",level:2},{value:"Response Status Codes",id:"response-status-codes",level:2},{value:"JSON Responses",id:"json-responses",level:2},{value:"CORS",id:"cors",level:2},{value:"Authentication",id:"authentication",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Validation",id:"validation",level:2},{value:"Common Patterns",id:"common-patterns",level:2},{value:"List with Pagination",id:"list-with-pagination",level:3},{value:"REST CRUD",id:"rest-crud",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Next Steps",id:"next-steps",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"api-routes",children:"API Routes"})}),"\n",(0,t.jsx)(n.p,{children:"Build REST APIs with Jen.js API routes."}),"\n",(0,t.jsx)(n.h2,{id:"creating-api-routes",children:"Creating API Routes"}),"\n",(0,t.jsxs)(n.p,{children:["API routes are ",(0,t.jsx)(n.code,{children:".ts"})," files that export an async ",(0,t.jsx)(n.code,{children:"handle"})," function:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"site/api/\n\u251c\u2500\u2500 (users).ts       \u2192 /api/users\n\u251c\u2500\u2500 (posts).ts       \u2192 /api/posts\n\u2514\u2500\u2500 auth/\n    \u251c\u2500\u2500 (login).ts   \u2192 /api/auth/login\n    \u2514\u2500\u2500 (logout).ts  \u2192 /api/auth/logout\n"})}),"\n",(0,t.jsx)(n.h2,{id:"basic-api-route",children:"Basic API Route"}),"\n",(0,t.jsxs)(n.p,{children:["Create ",(0,t.jsx)(n.code,{children:"site/api/(users).ts"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import type { IncomingMessage, ServerResponse } from 'node:http';\n\nexport async function handle(req: IncomingMessage, res: ServerResponse) {\n  if (req.method === 'GET') {\n    const users = [\n      { id: 1, name: 'Alice' },\n      { id: 2, name: 'Bob' }\n    ];\n    \n    res.writeHead(200, { 'content-type': 'application/json' });\n    res.end(JSON.stringify(users));\n  }\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Visit ",(0,t.jsx)(n.code,{children:"GET /api/users"})," to get the list."]}),"\n",(0,t.jsx)(n.h2,{id:"http-methods",children:"HTTP Methods"}),"\n",(0,t.jsx)(n.p,{children:"Handle different HTTP methods:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// site/api/(posts).ts\n\nexport async function handle(req: IncomingMessage, res: ServerResponse) {\n  if (req.method === 'GET') {\n    // Get posts\n    return handleGet(req, res);\n  } else if (req.method === 'POST') {\n    // Create post\n    return handlePost(req, res);\n  } else if (req.method === 'PUT') {\n    // Update post\n    return handlePut(req, res);\n  } else if (req.method === 'DELETE') {\n    // Delete post\n    return handleDelete(req, res);\n  } else {\n    res.writeHead(405);\n    res.end('Method not allowed');\n  }\n}\n\nasync function handleGet(req: IncomingMessage, res: ServerResponse) {\n  res.writeHead(200, { 'content-type': 'application/json' });\n  res.end(JSON.stringify({ posts: [] }));\n}\n\nasync function handlePost(req: IncomingMessage, res: ServerResponse) {\n  res.writeHead(201, { 'content-type': 'application/json' });\n  res.end(JSON.stringify({ id: 1, title: 'New post' }));\n}\n\nasync function handlePut(req: IncomingMessage, res: ServerResponse) {\n  res.writeHead(200, { 'content-type': 'application/json' });\n  res.end(JSON.stringify({ id: 1, title: 'Updated' }));\n}\n\nasync function handleDelete(req: IncomingMessage, res: ServerResponse) {\n  res.writeHead(204);\n  res.end();\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"query-parameters",children:"Query Parameters"}),"\n",(0,t.jsx)(n.p,{children:"Access URL query strings:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// site/api/(search).ts\n\nexport async function handle(req: IncomingMessage, res: ServerResponse) {\n  const url = new URL(req.url || '', `http://${req.headers.host}`);\n  const query = url.searchParams.get('q');\n  const limit = url.searchParams.get('limit') || '10';\n  \n  const results = await searchDatabase(query, parseInt(limit));\n  \n  res.writeHead(200, { 'content-type': 'application/json' });\n  res.end(JSON.stringify(results));\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Visit ",(0,t.jsx)(n.code,{children:"GET /api/search?q=typescript&limit=20"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"route-parameters",children:"Route Parameters"}),"\n",(0,t.jsx)(n.p,{children:"Dynamic route parameters:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// site/api/users/($id).ts\n\nexport async function handle(req: IncomingMessage, res: ServerResponse) {\n  const { id } = req.params as { id: string };\n  \n  const user = await db.query('users', { id: parseInt(id) });\n  \n  if (!user) {\n    res.writeHead(404, { 'content-type': 'application/json' });\n    res.end(JSON.stringify({ error: 'User not found' }));\n    return;\n  }\n  \n  res.writeHead(200, { 'content-type': 'application/json' });\n  res.end(JSON.stringify(user));\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Visit ",(0,t.jsx)(n.code,{children:"GET /api/users/123"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"request-body",children:"Request Body"}),"\n",(0,t.jsx)(n.p,{children:"Read JSON request body:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// site/api/(users).ts\n\nexport async function handle(req: IncomingMessage, res: ServerResponse) {\n  if (req.method === 'POST') {\n    const body = await readBody(req);\n    const data = JSON.parse(body);\n    \n    const user = await db.create('users', data);\n    \n    res.writeHead(201, { 'content-type': 'application/json' });\n    res.end(JSON.stringify(user));\n  }\n}\n\nasync function readBody(req: IncomingMessage): Promise<string> {\n  return new Promise((resolve, reject) => {\n    let data = '';\n    req.on('data', chunk => (data += chunk));\n    req.on('end', () => resolve(data));\n    req.on('error', reject);\n  });\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"response-status-codes",children:"Response Status Codes"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Success\nres.writeHead(200);  // OK\nres.writeHead(201);  // Created\nres.writeHead(204);  // No Content\n\n// Errors\nres.writeHead(400);  // Bad Request\nres.writeHead(401);  // Unauthorized\nres.writeHead(403);  // Forbidden\nres.writeHead(404);  // Not Found\nres.writeHead(500);  // Server Error\n"})}),"\n",(0,t.jsx)(n.h2,{id:"json-responses",children:"JSON Responses"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"export async function handle(req: IncomingMessage, res: ServerResponse) {\n  const data = {\n    success: true,\n    message: 'Data retrieved',\n    data: { id: 1, name: 'John' }\n  };\n  \n  res.writeHead(200, {\n    'content-type': 'application/json',\n    'content-length': JSON.stringify(data).length\n  });\n  res.end(JSON.stringify(data));\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"cors",children:"CORS"}),"\n",(0,t.jsx)(n.p,{children:"Enable CORS for cross-origin requests:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"export async function handle(req: IncomingMessage, res: ServerResponse) {\n  // Add CORS headers\n  res.setHeader('access-control-allow-origin', '*');\n  res.setHeader('access-control-allow-methods', 'GET, POST, PUT, DELETE');\n  res.setHeader('access-control-allow-headers', 'content-type');\n  \n  // Handle preflight\n  if (req.method === 'OPTIONS') {\n    res.writeHead(200);\n    res.end();\n    return;\n  }\n  \n  // Handle request\n  if (req.method === 'GET') {\n    res.writeHead(200, { 'content-type': 'application/json' });\n    res.end(JSON.stringify({ data: [] }));\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"authentication",children:"Authentication"}),"\n",(0,t.jsx)(n.p,{children:"Check authorization headers:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { verifyToken } from '@src/auth/jwt';\n\nexport async function handle(req: IncomingMessage, res: ServerResponse) {\n  const authHeader = req.headers['authorization'];\n  \n  if (!authHeader) {\n    res.writeHead(401, { 'content-type': 'application/json' });\n    res.end(JSON.stringify({ error: 'Unauthorized' }));\n    return;\n  }\n  \n  try {\n    const token = authHeader.replace('Bearer ', '');\n    const payload = verifyToken(token);\n    \n    // User is authenticated\n    res.writeHead(200, { 'content-type': 'application/json' });\n    res.end(JSON.stringify({ user: payload }));\n  } catch (error) {\n    res.writeHead(403, { 'content-type': 'application/json' });\n    res.end(JSON.stringify({ error: 'Invalid token' }));\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,t.jsx)(n.p,{children:"Handle errors gracefully:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"export async function handle(req: IncomingMessage, res: ServerResponse) {\n  try {\n    if (req.method === 'GET') {\n      const data = await fetchData();\n      res.writeHead(200, { 'content-type': 'application/json' });\n      res.end(JSON.stringify(data));\n    }\n  } catch (error) {\n    console.error('API error:', error);\n    res.writeHead(500, { 'content-type': 'application/json' });\n    res.end(JSON.stringify({ \n      error: 'Internal server error' \n    }));\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"validation",children:"Validation"}),"\n",(0,t.jsx)(n.p,{children:"Validate request data:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"export async function handle(req: IncomingMessage, res: ServerResponse) {\n  if (req.method === 'POST') {\n    const body = await readBody(req);\n    const data = JSON.parse(body);\n    \n    // Validate input\n    if (!data.name || typeof data.name !== 'string') {\n      res.writeHead(400, { 'content-type': 'application/json' });\n      res.end(JSON.stringify({ error: 'Invalid name' }));\n      return;\n    }\n    \n    if (!data.email || !isValidEmail(data.email)) {\n      res.writeHead(400, { 'content-type': 'application/json' });\n      res.end(JSON.stringify({ error: 'Invalid email' }));\n      return;\n    }\n    \n    // Proceed\n    const user = await db.create('users', data);\n    res.writeHead(201, { 'content-type': 'application/json' });\n    res.end(JSON.stringify(user));\n  }\n}\n\nfunction isValidEmail(email: string): boolean {\n  return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email);\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"common-patterns",children:"Common Patterns"}),"\n",(0,t.jsx)(n.h3,{id:"list-with-pagination",children:"List with Pagination"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// site/api/(posts).ts\n\nexport async function handle(req: IncomingMessage, res: ServerResponse) {\n  const url = new URL(req.url || '', `http://${req.headers.host}`);\n  const page = parseInt(url.searchParams.get('page') || '1');\n  const limit = parseInt(url.searchParams.get('limit') || '10');\n  \n  const offset = (page - 1) * limit;\n  \n  const [posts, total] = await Promise.all([\n    db.query('posts', { offset, limit }),\n    db.query('posts', { count: true })\n  ]);\n  \n  res.writeHead(200, { 'content-type': 'application/json' });\n  res.end(JSON.stringify({\n    posts,\n    pagination: {\n      page,\n      limit,\n      total,\n      pages: Math.ceil(total / limit)\n    }\n  }));\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"rest-crud",children:"REST CRUD"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// site/api/posts/($id).ts\n\nexport async function handle(req: IncomingMessage, res: ServerResponse) {\n  const { id } = req.params as { id: string };\n  \n  try {\n    if (req.method === 'GET') {\n      const post = await db.query('posts', { id: parseInt(id) });\n      \n      if (!post) {\n        res.writeHead(404);\n        res.end();\n        return;\n      }\n      \n      res.writeHead(200, { 'content-type': 'application/json' });\n      res.end(JSON.stringify(post));\n      \n    } else if (req.method === 'PUT') {\n      const body = await readBody(req);\n      const data = JSON.parse(body);\n      \n      const updated = await db.update('posts', { id: parseInt(id) }, data);\n      \n      res.writeHead(200, { 'content-type': 'application/json' });\n      res.end(JSON.stringify(updated));\n      \n    } else if (req.method === 'DELETE') {\n      await db.delete('posts', { id: parseInt(id) });\n      \n      res.writeHead(204);\n      res.end();\n    } else {\n      res.writeHead(405);\n      res.end();\n    }\n  } catch (error) {\n    res.writeHead(500, { 'content-type': 'application/json' });\n    res.end(JSON.stringify({ error: 'Server error' }));\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Use proper HTTP methods"})," - GET, POST, PUT, DELETE"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Validate all inputs"})," - Check types and format"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Return proper status codes"})," - 200, 201, 400, 401, 404, 500"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Use consistent response format"})," - Wrap data and errors"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Log errors"})," - Track failed requests"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Implement rate limiting"})," - Prevent abuse"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Use authentication"})," - Protect sensitive endpoints"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Document endpoints"})," - Include examples"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"./database",children:"Database"})," - Query and store data"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"./auth",children:"Authentication"})," - Secure your API"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"./middleware",children:"Middleware"})," - Add cross-cutting concerns"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},6145(e,n,s){s.d(n,{R:()=>a,x:()=>o});var r=s(7140);const t={},i=r.createContext(t);function a(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);