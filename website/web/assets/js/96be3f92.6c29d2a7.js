"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[5075],{3818(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>o,frontMatter:()=>r,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"cache","title":"Caching","description":"Optimize performance with intelligent caching strategies.","source":"@site/docs/cache.md","sourceDirName":".","slug":"/cache","permalink":"/docs/cache","draft":false,"unlisted":false,"editUrl":"https://github.com/kessud2021/Jen.js/tree/main/website/docs/cache.md","tags":[],"version":"current","sidebarPosition":12,"frontMatter":{"sidebar_position":12},"sidebar":"docs","previous":{"title":"Middleware","permalink":"/docs/middleware"},"next":{"title":"Plugins","permalink":"/docs/plugins"}}');var c=t(5656),s=t(6145);const r={sidebar_position:12},i="Caching",l={},d=[{value:"Cache Layers",id:"cache-layers",level:2},{value:"HTTP Caching",id:"http-caching",level:2},{value:"Cache Control Values",id:"cache-control-values",level:3},{value:"Data Caching",id:"data-caching",level:2},{value:"Page Caching",id:"page-caching",level:2},{value:"Cache Invalidation",id:"cache-invalidation",level:2},{value:"Redis Caching",id:"redis-caching",level:2},{value:"Memory Caching",id:"memory-caching",level:2},{value:"Cache Tags",id:"cache-tags",level:2},{value:"Stale-While-Revalidate",id:"stale-while-revalidate",level:2},{value:"ETag",id:"etag",level:2},{value:"Cache Strategies",id:"cache-strategies",level:2},{value:"Cache-First",id:"cache-first",level:3},{value:"Network-First",id:"network-first",level:3},{value:"Stale-While-Revalidate",id:"stale-while-revalidate-1",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Next Steps",id:"next-steps",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"caching",children:"Caching"})}),"\n",(0,c.jsx)(n.p,{children:"Optimize performance with intelligent caching strategies."}),"\n",(0,c.jsx)(n.h2,{id:"cache-layers",children:"Cache Layers"}),"\n",(0,c.jsx)(n.p,{children:"Jen.js supports multiple caching layers:"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"HTTP Caching"})," - Browser and CDN cache"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Data Caching"})," - Cache query results"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Page Caching"})," - Cache rendered pages"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Asset Caching"})," - Cache static files"]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"http-caching",children:"HTTP Caching"}),"\n",(0,c.jsx)(n.p,{children:"Set cache headers on pages:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:'// site/(blog).tsx\n\nexport function Head() {\n  return (\n    <meta\n      httpEquiv="cache-control"\n      content="public, max-age=3600, must-revalidate"\n    />\n  );\n}\n\nexport async function loader(ctx: LoaderContext) {\n  return { posts: [] };\n}\n\nexport default function Blog({ data }: any) {\n  return <div>{/* ... */}</div>;\n}\n'})}),"\n",(0,c.jsx)(n.h3,{id:"cache-control-values",children:"Cache Control Values"}),"\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:"Directive"}),(0,c.jsx)(n.th,{children:"Effect"})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"public"})}),(0,c.jsx)(n.td,{children:"Cacheable by browser and CDN"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"private"})}),(0,c.jsx)(n.td,{children:"Cacheable only by browser"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"no-cache"})}),(0,c.jsx)(n.td,{children:"Must revalidate before use"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"no-store"})}),(0,c.jsx)(n.td,{children:"Don't cache at all"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"max-age=3600"})}),(0,c.jsx)(n.td,{children:"Cache for 3600 seconds"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"must-revalidate"})}),(0,c.jsx)(n.td,{children:"Revalidate when stale"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"immutable"})}),(0,c.jsx)(n.td,{children:"Never change (for assets)"})]})]})]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:'// Static content - cache forever\n<meta httpEquiv="cache-control" content="public, max-age=31536000, immutable" />\n\n// Dynamic content - short cache\n<meta httpEquiv="cache-control" content="public, max-age=300, must-revalidate" />\n\n// Private data - browser only\n<meta httpEquiv="cache-control" content="private, max-age=3600" />\n\n// Don\'t cache\n<meta httpEquiv="cache-control" content="no-store" />\n'})}),"\n",(0,c.jsx)(n.h2,{id:"data-caching",children:"Data Caching"}),"\n",(0,c.jsx)(n.p,{children:"Cache database and API query results:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:"// site/(users).tsx\n\nconst userCache = new Map<number, any>();\nconst CACHE_TTL = 5 * 60 * 1000;  // 5 minutes\n\nexport async function loader(ctx: LoaderContext) {\n  const { id } = ctx.query;\n  \n  // Check cache\n  if (userCache.has(parseInt(id))) {\n    const cached = userCache.get(parseInt(id));\n    if (Date.now() - cached.timestamp < CACHE_TTL) {\n      return cached.data;\n    }\n  }\n  \n  // Fetch fresh data\n  const user = await db.query('users', { id: parseInt(id) });\n  \n  // Store in cache\n  userCache.set(parseInt(id), {\n    data: user,\n    timestamp: Date.now()\n  });\n  \n  return user;\n}\n"})}),"\n",(0,c.jsx)(n.h2,{id:"page-caching",children:"Page Caching"}),"\n",(0,c.jsx)(n.p,{children:"Cache entire rendered pages:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:"export const renderConfig = {\n  mode: 'ssg',\n  cache: {\n    ttl: 3600,      // Cache for 1 hour\n    tags: ['posts']  // For invalidation\n  }\n};\n\nexport async function loader(ctx: LoaderContext) {\n  return await expensiveDataFetch();\n}\n"})}),"\n",(0,c.jsx)(n.h2,{id:"cache-invalidation",children:"Cache Invalidation"}),"\n",(0,c.jsx)(n.p,{children:"Invalidate cache when data changes:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:"// site/api/posts/(create).ts\n\nexport async function handle(req: IncomingMessage, res: ServerResponse) {\n  if (req.method === 'POST') {\n    const newPost = await db.create('posts', req.body);\n    \n    // Invalidate posts cache\n    await invalidateCache('posts');\n    \n    res.writeHead(201);\n    res.end(JSON.stringify(newPost));\n  }\n}\n\nasync function invalidateCache(tag: string) {\n  // Implementation depends on cache backend\n  console.log(`Invalidated cache: ${tag}`);\n}\n"})}),"\n",(0,c.jsx)(n.h2,{id:"redis-caching",children:"Redis Caching"}),"\n",(0,c.jsx)(n.p,{children:"Use Redis for distributed caching:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:"// src/cache/redis.ts\n\nimport { createClient } from 'redis';\n\nconst client = createClient({ host: 'localhost', port: 6379 });\n\nexport async function get(key: string): Promise<any> {\n  await client.connect();\n  const value = await client.get(key);\n  await client.disconnect();\n  return value ? JSON.parse(value) : null;\n}\n\nexport async function set(key: string, value: any, ttl?: number): Promise<void> {\n  await client.connect();\n  if (ttl) {\n    await client.setEx(key, ttl, JSON.stringify(value));\n  } else {\n    await client.set(key, JSON.stringify(value));\n  }\n  await client.disconnect();\n}\n\nexport async function del(key: string): Promise<void> {\n  await client.connect();\n  await client.del(key);\n  await client.disconnect();\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"Use in loaders:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:"import * as cache from '@src/cache/redis';\n\nexport async function loader(ctx: LoaderContext) {\n  const cacheKey = `posts:${ctx.query.page}`;\n  \n  // Check cache\n  let posts = await cache.get(cacheKey);\n  \n  if (!posts) {\n    // Fetch from database\n    posts = await db.query('posts', {\n      limit: 10,\n      offset: (parseInt(ctx.query.page) - 1) * 10\n    });\n    \n    // Store in cache (1 hour TTL)\n    await cache.set(cacheKey, posts, 3600);\n  }\n  \n  return { posts };\n}\n"})}),"\n",(0,c.jsx)(n.h2,{id:"memory-caching",children:"Memory Caching"}),"\n",(0,c.jsx)(n.p,{children:"Simple in-memory cache:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:"// src/cache/memory.ts\n\ninterface CacheEntry {\n  value: any;\n  expiresAt: number;\n}\n\nconst cache = new Map<string, CacheEntry>();\n\nexport function get(key: string): any {\n  const entry = cache.get(key);\n  \n  if (!entry) return null;\n  \n  if (Date.now() > entry.expiresAt) {\n    cache.delete(key);\n    return null;\n  }\n  \n  return entry.value;\n}\n\nexport function set(key: string, value: any, ttlSeconds: number = 3600): void {\n  cache.set(key, {\n    value,\n    expiresAt: Date.now() + (ttlSeconds * 1000)\n  });\n}\n\nexport function delete(key: string): void {\n  cache.delete(key);\n}\n\nexport function clear(): void {\n  cache.clear();\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"Use in loaders:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:"import * as cache from '@src/cache/memory';\n\nexport async function loader(ctx: LoaderContext) {\n  const cacheKey = `page:${ctx.params.slug}`;\n  \n  let page = cache.get(cacheKey);\n  \n  if (!page) {\n    page = await db.query('pages', { slug: ctx.params.slug });\n    cache.set(cacheKey, page, 1800);  // 30 minutes\n  }\n  \n  return page;\n}\n"})}),"\n",(0,c.jsx)(n.h2,{id:"cache-tags",children:"Cache Tags"}),"\n",(0,c.jsx)(n.p,{children:"Group related cache entries for bulk invalidation:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:"// src/cache/tags.ts\n\nconst tagIndex = new Map<string, Set<string>>();\n\nexport function set(key: string, value: any, ttl: number, tags: string[]): void {\n  // Store value\n  cache.set(key, value, ttl);\n  \n  // Index tags\n  for (const tag of tags) {\n    if (!tagIndex.has(tag)) {\n      tagIndex.set(tag, new Set());\n    }\n    tagIndex.get(tag)!.add(key);\n  }\n}\n\nexport function invalidateTag(tag: string): void {\n  const keys = tagIndex.get(tag);\n  \n  if (keys) {\n    for (const key of keys) {\n      cache.delete(key);\n    }\n    tagIndex.delete(tag);\n  }\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"Usage:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:"export const renderConfig = {\n  cache: {\n    ttl: 3600,\n    tags: ['posts', 'homepage']\n  }\n};\n\nexport async function loader(ctx: LoaderContext) {\n  return await getPosts();\n}\n\n// On post update:\nimport * as cache from '@src/cache/tags';\n\nexport async function handle(req: IncomingMessage, res: ServerResponse) {\n  if (req.method === 'POST') {\n    const post = await db.create('posts', req.body);\n    \n    cache.invalidateTag('posts');\n    cache.invalidateTag('homepage');\n    \n    res.writeHead(201);\n    res.end(JSON.stringify(post));\n  }\n}\n"})}),"\n",(0,c.jsx)(n.h2,{id:"stale-while-revalidate",children:"Stale-While-Revalidate"}),"\n",(0,c.jsx)(n.p,{children:"Serve stale content while refreshing in background:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:'export function Head() {\n  return (\n    <meta\n      httpEquiv="cache-control"\n      content="public, max-age=600, stale-while-revalidate=86400"\n    />\n  );\n}\n'})}),"\n",(0,c.jsx)(n.p,{children:"This caches for 10 minutes, and allows stale content for up to 1 day while revalidating."}),"\n",(0,c.jsx)(n.h2,{id:"etag",children:"ETag"}),"\n",(0,c.jsx)(n.p,{children:"Use ETags for conditional requests:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:"import { createHash } from 'node:crypto';\n\nexport async function loader(ctx: LoaderContext) {\n  const data = await fetchData();\n  const etag = createHash('md5').update(JSON.stringify(data)).digest('hex');\n  \n  // Check If-None-Match header\n  if (ctx.req?.headers['if-none-match'] === etag) {\n    ctx.res?.writeHead(304);  // Not Modified\n    ctx.res?.end();\n    return;\n  }\n  \n  // Set ETag header\n  ctx.res?.setHeader('etag', etag);\n  \n  return data;\n}\n"})}),"\n",(0,c.jsx)(n.h2,{id:"cache-strategies",children:"Cache Strategies"}),"\n",(0,c.jsx)(n.h3,{id:"cache-first",children:"Cache-First"}),"\n",(0,c.jsx)(n.p,{children:"Use cache, fallback to fetch:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:"async function getCachedData(key: string, fetcher: () => Promise<any>) {\n  const cached = await cache.get(key);\n  if (cached) return cached;\n  \n  const fresh = await fetcher();\n  await cache.set(key, fresh, 3600);\n  return fresh;\n}\n"})}),"\n",(0,c.jsx)(n.h3,{id:"network-first",children:"Network-First"}),"\n",(0,c.jsx)(n.p,{children:"Fetch fresh, fallback to cache:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:"async function getFreshData(key: string, fetcher: () => Promise<any>) {\n  try {\n    const fresh = await fetcher();\n    await cache.set(key, fresh, 3600);\n    return fresh;\n  } catch (error) {\n    const cached = await cache.get(key);\n    return cached || { error: 'Failed to fetch' };\n  }\n}\n"})}),"\n",(0,c.jsx)(n.h3,{id:"stale-while-revalidate-1",children:"Stale-While-Revalidate"}),"\n",(0,c.jsx)(n.p,{children:"Return cache immediately, update in background:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:"async function getSwrData(key: string, fetcher: () => Promise<any>) {\n  const cached = await cache.get(key);\n  \n  // Return cached immediately\n  if (cached) {\n    // Revalidate in background\n    fetcher().then(fresh => {\n      cache.set(key, fresh, 3600);\n    });\n    return cached;\n  }\n  \n  // No cache, fetch\n  const fresh = await fetcher();\n  await cache.set(key, fresh, 3600);\n  return fresh;\n}\n"})}),"\n",(0,c.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Cache at multiple layers"})," - HTTP, data, page"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Use appropriate TTLs"})," - Shorter for dynamic content"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Invalidate strategically"})," - Don't over-invalidate"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Monitor cache hits"})," - Track effectiveness"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Handle cache misses"})," - Graceful fallbacks"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Consider consistency"})," - vs performance tradeoff"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Test cache behavior"})," - Verify invalidation works"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Use cache headers"})," - Let CDN help"]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.a,{href:"./performance",children:"Performance"})," - Optimize your site"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.a,{href:"./database",children:"Database"})," - Query efficiently"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.a,{href:"./build",children:"Build"})," - Production optimization"]}),"\n"]})]})}function o(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(h,{...e})}):h(e)}},6145(e,n,t){t.d(n,{R:()=>r,x:()=>i});var a=t(7140);const c={},s=a.createContext(c);function r(e){const n=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:r(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);