"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[6071],{1847(e,n,t){t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"data-loading","title":"Data Loading","description":"Deep dive into loading and managing data in Jen.js routes.","source":"@site/docs/data-loading.md","sourceDirName":".","slug":"/data-loading","permalink":"/docs/data-loading","draft":false,"unlisted":false,"editUrl":"https://github.com/kessud2021/Jen.js/tree/main/website/docs/data-loading.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7},"sidebar":"docs","previous":{"title":"Components & Data Loading","permalink":"/docs/components"},"next":{"title":"API Routes","permalink":"/docs/api"}}');var a=t(5656),r=t(6145);const i={sidebar_position:7},o="Data Loading",d={},c=[{value:"Loader Context",id:"loader-context",level:2},{value:"Using Params",id:"using-params",level:2},{value:"Using Query Parameters",id:"using-query-parameters",level:2},{value:"Database Integration",id:"database-integration",level:2},{value:"Initialize DB",id:"initialize-db",level:3},{value:"Query Patterns",id:"query-patterns",level:3},{value:"Single Record",id:"single-record",level:4},{value:"Multiple Records",id:"multiple-records",level:4},{value:"With Filtering",id:"with-filtering",level:4},{value:"With Relationships",id:"with-relationships",level:4},{value:"Caching",id:"caching",level:2},{value:"Set Cache in Loader",id:"set-cache-in-loader",level:3},{value:"Revalidate Cache",id:"revalidate-cache",level:3},{value:"Parallel Data Loading",id:"parallel-data-loading",level:2},{value:"Conditional Loading",id:"conditional-loading",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Not Found",id:"not-found",level:3},{value:"Error Response",id:"error-response",level:3},{value:"Validation",id:"validation",level:3},{value:"Server Context (SSR Only)",id:"server-context-ssr-only",level:2},{value:"Streaming Data",id:"streaming-data",level:2},{value:"Caching Strategies",id:"caching-strategies",level:2},{value:"Cache-Control Headers",id:"cache-control-headers",level:3},{value:"ETag / Last-Modified",id:"etag--last-modified",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Performance Tips",id:"performance-tips",level:2},{value:"Next Steps",id:"next-steps",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"data-loading",children:"Data Loading"})}),"\n",(0,a.jsx)(n.p,{children:"Deep dive into loading and managing data in Jen.js routes."}),"\n",(0,a.jsx)(n.h2,{id:"loader-context",children:"Loader Context"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"loader"})," function receives a ",(0,a.jsx)(n.code,{children:"LoaderContext"})," object with all request information:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"interface LoaderContext {\n  params: Record<string, string>;              // Dynamic route parameters\n  query: Record<string, string | string[]>;   // Query string values\n  req?: IncomingMessage;                      // HTTP request (SSR only)\n  res?: ServerResponse;                       // HTTP response (SSR only)\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"using-params",children:"Using Params"}),"\n",(0,a.jsxs)(n.p,{children:["Dynamic route parameters are available in ",(0,a.jsx)(n.code,{children:"ctx.params"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"// site/posts/($id)/($version).tsx\n\nexport async function loader(ctx: LoaderContext) {\n  const { id, version } = ctx.params;\n  \n  console.log(`Loading post ${id}, version ${version}`);\n  \n  const post = await db.query('posts', { id, version });\n  return post;\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Visiting ",(0,a.jsx)(n.code,{children:"/posts/123/2"})," provides ",(0,a.jsx)(n.code,{children:"params: { id: '123', version: '2' }"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"using-query-parameters",children:"Using Query Parameters"}),"\n",(0,a.jsxs)(n.p,{children:["Access URL query strings via ",(0,a.jsx)(n.code,{children:"ctx.query"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"// site/(search).tsx\n\nexport async function loader(ctx: LoaderContext) {\n  const { q, page = '1', limit = '10' } = ctx.query;\n  \n  const offset = (parseInt(page) - 1) * parseInt(limit);\n  \n  const results = await db.query('posts', {\n    search: q,\n    offset,\n    limit: parseInt(limit)\n  });\n  \n  return { results, page, limit };\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Visit ",(0,a.jsx)(n.code,{children:"/search?q=typescript&page=2&limit=20"})," to search."]}),"\n",(0,a.jsx)(n.h2,{id:"database-integration",children:"Database Integration"}),"\n",(0,a.jsx)(n.h3,{id:"initialize-db",children:"Initialize DB"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"import { DB } from '@src/db';\n\nexport async function loader(ctx: LoaderContext) {\n  const db = new DB({\n    driver: 'sqlite',\n    connectionString: 'data/app.db'\n  });\n  \n  await db.connect();\n  \n  const users = await db.query('users', {});\n  \n  await db.disconnect();\n  \n  return { users };\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"query-patterns",children:"Query Patterns"}),"\n",(0,a.jsx)(n.h4,{id:"single-record",children:"Single Record"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"const post = await db.query('posts', { id: 123 });\n"})}),"\n",(0,a.jsx)(n.h4,{id:"multiple-records",children:"Multiple Records"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"const posts = await db.query('posts', { where: { published: true } });\n"})}),"\n",(0,a.jsx)(n.h4,{id:"with-filtering",children:"With Filtering"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"const posts = await db.query('posts', {\n  where: { published: true },\n  orderBy: { createdAt: 'desc' },\n  limit: 10\n});\n"})}),"\n",(0,a.jsx)(n.h4,{id:"with-relationships",children:"With Relationships"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"const posts = await db.query('posts', {\n  include: { author: true, comments: true }\n});\n"})}),"\n",(0,a.jsx)(n.h2,{id:"caching",children:"Caching"}),"\n",(0,a.jsx)(n.p,{children:"Cache loader results to improve performance:"}),"\n",(0,a.jsx)(n.h3,{id:"set-cache-in-loader",children:"Set Cache in Loader"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"export const renderConfig = {\n  cache: {\n    ttl: 3600,    // Cache for 1 hour\n    tags: ['posts']\n  }\n};\n\nexport async function loader(ctx: LoaderContext) {\n  return await fetchExpensiveData();\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"revalidate-cache",children:"Revalidate Cache"}),"\n",(0,a.jsx)(n.p,{children:"Invalidate cache on updates:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"// site/api/(posts).ts\n\nexport async function handle(req: IncomingMessage, res: ServerResponse) {\n  if (req.method === 'POST') {\n    const post = await createPost(req);\n    \n    // Invalidate posts cache\n    await revalidateTag('posts');\n    \n    res.writeHead(201, { 'content-type': 'application/json' });\n    res.end(JSON.stringify(post));\n  }\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"parallel-data-loading",children:"Parallel Data Loading"}),"\n",(0,a.jsx)(n.p,{children:"Load multiple data sources in parallel:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"export async function loader(ctx: LoaderContext) {\n  const [posts, users, comments] = await Promise.all([\n    db.query('posts', {}),\n    db.query('users', {}),\n    db.query('comments', {})\n  ]);\n  \n  return { posts, users, comments };\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"conditional-loading",children:"Conditional Loading"}),"\n",(0,a.jsx)(n.p,{children:"Load data based on conditions:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"export async function loader(ctx: LoaderContext) {\n  const { id } = ctx.params;\n  const userId = ctx.req?.headers['x-user-id'];\n  \n  const post = await db.query('posts', { id });\n  \n  // Only load comments if authenticated\n  const comments = userId \n    ? await db.query('comments', { postId: id })\n    : [];\n  \n  return { post, comments };\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,a.jsx)(n.h3,{id:"not-found",children:"Not Found"}),"\n",(0,a.jsx)(n.p,{children:"Return a 404 status:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"export async function loader(ctx: LoaderContext) {\n  const { id } = ctx.params;\n  \n  const post = await db.query('posts', { id });\n  \n  if (!post) {\n    return { notFound: true };\n  }\n  \n  return post;\n}\n\nexport default function Post({ data }: any) {\n  if (data.notFound) {\n    return <h1>404 - Post not found</h1>;\n  }\n  \n  return <h1>{data.title}</h1>;\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"error-response",children:"Error Response"}),"\n",(0,a.jsx)(n.p,{children:"Handle errors gracefully:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"export async function loader(ctx: LoaderContext) {\n  try {\n    const data = await fetchData();\n    return data;\n  } catch (error) {\n    console.error('Failed to load data:', error);\n    return { \n      error: 'Failed to load data',\n      statusCode: 500 \n    };\n  }\n}\n\nexport default function Page({ data }: any) {\n  if (data.error) {\n    return <h1>Error: {data.error}</h1>;\n  }\n  \n  return <h1>Success</h1>;\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"validation",children:"Validation"}),"\n",(0,a.jsx)(n.p,{children:"Validate inputs before processing:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"export async function loader(ctx: LoaderContext) {\n  const { id } = ctx.params;\n  \n  // Validate ID format\n  if (!/^\\d+$/.test(id)) {\n    return { error: 'Invalid ID format' };\n  }\n  \n  const post = await db.query('posts', { id: parseInt(id) });\n  \n  return post;\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"server-context-ssr-only",children:"Server Context (SSR Only)"}),"\n",(0,a.jsx)(n.p,{children:"In SSR mode, access HTTP request and response objects:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"export async function loader(ctx: LoaderContext) {\n  // HTTP request headers\n  const authHeader = ctx.req?.headers['authorization'];\n  const userAgent = ctx.req?.headers['user-agent'];\n  \n  // Validate authentication\n  if (!authHeader) {\n    ctx.res?.writeHead(401, { 'content-type': 'application/json' });\n    ctx.res?.end(JSON.stringify({ error: 'Unauthorized' }));\n    return;\n  }\n  \n  // Load authenticated user data\n  const user = await getCurrentUser(authHeader);\n  \n  return { user };\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"streaming-data",children:"Streaming Data"}),"\n",(0,a.jsx)(n.p,{children:"For large datasets, stream data instead of loading all at once:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"export async function loader(ctx: LoaderContext) {\n  const { limit = 10 } = ctx.query;\n  \n  // Load initial batch\n  const posts = await db.query('posts', { \n    limit: parseInt(limit),\n    orderBy: { createdAt: 'desc' }\n  });\n  \n  return { \n    posts,\n    hasMore: posts.length === parseInt(limit)\n  };\n}\n\nexport default function PostsList({ data }: any) {\n  const [posts, setPosts] = useState(data.posts);\n  \n  const loadMore = async () => {\n    const res = await fetch(`?limit=10&offset=${posts.length}`);\n    const newPosts = await res.json();\n    setPosts([...posts, ...newPosts]);\n  };\n  \n  return (\n    <div>\n      {posts.map(p => <div key={p.id}>{p.title}</div>)}\n      {data.hasMore && <button onClick={loadMore}>Load More</button>}\n    </div>\n  );\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"caching-strategies",children:"Caching Strategies"}),"\n",(0,a.jsx)(n.h3,{id:"cache-control-headers",children:"Cache-Control Headers"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'export function Head() {\n  return (\n    <meta \n      httpEquiv="cache-control" \n      content="public, max-age=3600, must-revalidate" \n    />\n  );\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"etag--last-modified",children:"ETag / Last-Modified"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"export async function loader(ctx: LoaderContext) {\n  const data = await fetchData();\n  const etag = generateETag(data);\n  \n  if (ctx.req?.headers['if-none-match'] === etag) {\n    ctx.res?.writeHead(304);\n    ctx.res?.end();\n    return;\n  }\n  \n  ctx.res?.setHeader('etag', etag);\n  \n  return data;\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Load only needed data"})," - Don't fetch extra fields"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Use pagination"})," - Limit database queries"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Cache aggressively"})," - Set appropriate TTLs"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Validate inputs"})," - Check params and query before use"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Handle errors"})," - Provide fallbacks for missing data"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Optimize queries"})," - Use indexes and relationships"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Log failures"})," - Track data loading issues"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Test loaders"})," - Mock database and external APIs"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"performance-tips",children:"Performance Tips"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Use database indexes"})," for frequently queried fields"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Select only needed columns"}),":"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"const posts = await db.query('posts', {\n  select: ['id', 'title', 'slug', 'excerpt']\n});\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"3",children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Batch queries"})," when possible:"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"const data = await Promise.all([\n  db.query('posts', {}),\n  db.query('users', {}),\n  db.query('categories', {})\n]);\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"4",children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Cache external API calls"}),":"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"const cache = new Map();\n\nexport async function loader(ctx: LoaderContext) {\n  const cacheKey = `external-${ctx.params.id}`;\n  \n  if (cache.has(cacheKey)) {\n    return cache.get(cacheKey);\n  }\n  \n  const data = await fetch(`https://api.example.com/${ctx.params.id}`);\n  cache.set(cacheKey, data);\n  \n  return data;\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"./api",children:"API Routes"})," - Build endpoints"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"./database",children:"Database"})," - Learn more about databases"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"./auth",children:"Authentication"})," - Protect your data"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},6145(e,n,t){t.d(n,{R:()=>i,x:()=>o});var s=t(7140);const a={},r=s.createContext(a);function i(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);