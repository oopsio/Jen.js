"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[822],{4229(n,e,s){s.r(e),s.d(e,{assets:()=>l,contentTitle:()=>d,default:()=>u,frontMatter:()=>r,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"database","title":"Database","description":"Jen.js supports multiple database drivers: SQLite, PostgreSQL, MySQL, and MongoDB.","source":"@site/docs/database.md","sourceDirName":".","slug":"/database","permalink":"/docs/database","draft":false,"unlisted":false,"editUrl":"https://github.com/kessud2021/Jen.js/tree/main/website/docs/database.md","tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"sidebar_position":9},"sidebar":"docs","previous":{"title":"API Routes","permalink":"/docs/api"},"next":{"title":"Authentication","permalink":"/docs/auth"}}');var i=s(5656),a=s(6145);const r={sidebar_position:9},d="Database",l={},c=[{value:"Supported Drivers",id:"supported-drivers",level:2},{value:"Installation",id:"installation",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Initialization",id:"initialization",level:2},{value:"Creating Tables",id:"creating-tables",level:2},{value:"Querying Data",id:"querying-data",level:2},{value:"Select",id:"select",level:3},{value:"Insert",id:"insert",level:3},{value:"Update",id:"update",level:3},{value:"Delete",id:"delete",level:3},{value:"Count",id:"count",level:3},{value:"Relationships",id:"relationships",level:2},{value:"One-to-Many",id:"one-to-many",level:3},{value:"Many-to-Many",id:"many-to-many",level:3},{value:"Transactions",id:"transactions",level:2},{value:"Raw Queries",id:"raw-queries",level:2},{value:"Validation",id:"validation",level:2},{value:"Migrations",id:"migrations",level:2},{value:"Hooks",id:"hooks",level:2},{value:"Connection Pooling",id:"connection-pooling",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Common Patterns",id:"common-patterns",level:2},{value:"User Registration",id:"user-registration",level:3},{value:"Paginated List",id:"paginated-list",level:3},{value:"Next Steps",id:"next-steps",level:2}];function o(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"database",children:"Database"})}),"\n",(0,i.jsx)(e.p,{children:"Jen.js supports multiple database drivers: SQLite, PostgreSQL, MySQL, and MongoDB."}),"\n",(0,i.jsx)(e.h2,{id:"supported-drivers",children:"Supported Drivers"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"Driver"}),(0,i.jsx)(e.th,{children:"Best For"}),(0,i.jsx)(e.th,{children:"Setup"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"SQLite"})}),(0,i.jsx)(e.td,{children:"Development, small projects"}),(0,i.jsx)(e.td,{children:"File-based, no server"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"PostgreSQL"})}),(0,i.jsx)(e.td,{children:"Production, complex queries"}),(0,i.jsx)(e.td,{children:"Requires PostgreSQL server"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"MySQL"})}),(0,i.jsx)(e.td,{children:"Production, MySQL ecosystem"}),(0,i.jsx)(e.td,{children:"Requires MySQL server"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"MongoDB"})}),(0,i.jsx)(e.td,{children:"Document-based, flexible schema"}),(0,i.jsx)(e.td,{children:"Requires MongoDB server"})]})]})]}),"\n",(0,i.jsx)(e.h2,{id:"installation",children:"Installation"}),"\n",(0,i.jsx)(e.p,{children:"Add database driver to your project:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# SQLite (included)\nnpm install better-sqlite3\n\n# PostgreSQL\nnpm install pg\n\n# MySQL\nnpm install mysql2\n\n# MongoDB\nnpm install mongodb\n"})}),"\n",(0,i.jsx)(e.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsxs)(e.p,{children:["Set database driver in ",(0,i.jsx)(e.code,{children:"jen.config.ts"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",children:"import type { FrameworkConfig } from '@src/core/types';\n\nconst config: FrameworkConfig = {\n  database: {\n    driver: 'sqlite',\n    connectionString: 'data/app.db'\n  }\n};\n\nexport default config;\n"})}),"\n",(0,i.jsx)(e.p,{children:"Or set via environment:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'export DATABASE_URL="postgresql://user:password@localhost/dbname"\nexport DATABASE_DRIVER="postgres"\n'})}),"\n",(0,i.jsx)(e.h2,{id:"initialization",children:"Initialization"}),"\n",(0,i.jsx)(e.p,{children:"Initialize database in your loaders or API routes:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",children:"import { DB } from '@src/db';\n\nexport async function loader(ctx: LoaderContext) {\n  const db = new DB({\n    driver: 'sqlite',\n    connectionString: 'data/app.db'\n  });\n  \n  await db.connect();\n  \n  try {\n    const users = await db.query('users', {});\n    return { users };\n  } finally {\n    await db.disconnect();\n  }\n}\n"})}),"\n",(0,i.jsx)(e.h2,{id:"creating-tables",children:"Creating Tables"}),"\n",(0,i.jsxs)(e.p,{children:["Define schemas in ",(0,i.jsx)(e.code,{children:"migrations/"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",children:"// migrations/001_create_users.ts\n\nexport async function up(db: DB) {\n  await db.execute(`\n    CREATE TABLE IF NOT EXISTS users (\n      id INTEGER PRIMARY KEY AUTO_INCREMENT,\n      name VARCHAR(255) NOT NULL,\n      email VARCHAR(255) UNIQUE NOT NULL,\n      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n    )\n  `);\n}\n\nexport async function down(db: DB) {\n  await db.execute('DROP TABLE users');\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:"Run migrations:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"npm run migrate\n"})}),"\n",(0,i.jsx)(e.h2,{id:"querying-data",children:"Querying Data"}),"\n",(0,i.jsx)(e.h3,{id:"select",children:"Select"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",children:"// Get all records\nconst users = await db.query('users', {});\n\n// Get one record\nconst user = await db.query('users', { \n  where: { id: 1 }\n});\n\n// Get with conditions\nconst activeUsers = await db.query('users', {\n  where: { status: 'active' }\n});\n\n// Select specific columns\nconst names = await db.query('users', {\n  select: ['id', 'name'],\n  where: { status: 'active' }\n});\n\n// With limit and offset\nconst page1 = await db.query('users', {\n  limit: 10,\n  offset: 0\n});\n\n// With ordering\nconst recent = await db.query('users', {\n  orderBy: { created_at: 'desc' },\n  limit: 10\n});\n\n// With search\nconst results = await db.query('users', {\n  where: { name: { contains: 'John' } }\n});\n"})}),"\n",(0,i.jsx)(e.h3,{id:"insert",children:"Insert"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",children:"const user = await db.create('users', {\n  name: 'Alice',\n  email: 'alice@example.com'\n});\n\n// Bulk insert\nconst users = await db.createMany('users', [\n  { name: 'Alice', email: 'alice@example.com' },\n  { name: 'Bob', email: 'bob@example.com' }\n]);\n"})}),"\n",(0,i.jsx)(e.h3,{id:"update",children:"Update"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",children:"// Update one\nconst user = await db.update(\n  'users',\n  { id: 1 },\n  { name: 'Updated Name' }\n);\n\n// Update many\nawait db.updateMany(\n  'users',\n  { status: 'pending' },\n  { status: 'active' }\n);\n"})}),"\n",(0,i.jsx)(e.h3,{id:"delete",children:"Delete"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",children:"// Delete one\nawait db.delete('users', { id: 1 });\n\n// Delete many\nawait db.deleteMany('users', { status: 'inactive' });\n"})}),"\n",(0,i.jsx)(e.h3,{id:"count",children:"Count"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",children:"const total = await db.count('users');\n\nconst active = await db.count('users', {\n  where: { status: 'active' }\n});\n"})}),"\n",(0,i.jsx)(e.h2,{id:"relationships",children:"Relationships"}),"\n",(0,i.jsx)(e.h3,{id:"one-to-many",children:"One-to-Many"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",children:"// Get posts with author\nconst posts = await db.query('posts', {\n  include: {\n    author: true\n  }\n});\n\n// Access in component\nexport default function Posts({ data }: any) {\n  return (\n    <div>\n      {data.posts.map(post => (\n        <div key={post.id}>\n          <h2>{post.title}</h2>\n          <p>By {post.author.name}</p>\n        </div>\n      ))}\n    </div>\n  );\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"many-to-many",children:"Many-to-Many"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",children:"// Get posts with tags\nconst posts = await db.query('posts', {\n  include: {\n    tags: true\n  }\n});\n"})}),"\n",(0,i.jsx)(e.h2,{id:"transactions",children:"Transactions"}),"\n",(0,i.jsx)(e.p,{children:"Run multiple queries atomically:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",children:"const result = await db.transaction(async (tx) => {\n  // Deduct from one account\n  await tx.update('accounts', { id: 1 }, { balance: 100 });\n  \n  // Add to another account\n  await tx.update('accounts', { id: 2 }, { balance: 150 });\n  \n  return { success: true };\n});\n"})}),"\n",(0,i.jsx)(e.h2,{id:"raw-queries",children:"Raw Queries"}),"\n",(0,i.jsx)(e.p,{children:"Execute custom SQL:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",children:"const users = await db.execute(`\n  SELECT u.id, u.name, COUNT(p.id) as post_count\n  FROM users u\n  LEFT JOIN posts p ON u.id = p.user_id\n  GROUP BY u.id\n  ORDER BY post_count DESC\n`);\n"})}),"\n",(0,i.jsx)(e.h2,{id:"validation",children:"Validation"}),"\n",(0,i.jsx)(e.p,{children:"Validate data before inserting:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",children:"export async function loader(ctx: LoaderContext) {\n  const { email } = ctx.query;\n  \n  if (!email || !isValidEmail(email)) {\n    return { error: 'Invalid email' };\n  }\n  \n  const user = await db.query('users', { where: { email } });\n  \n  return { user };\n}\n\nfunction isValidEmail(email: string): boolean {\n  return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email);\n}\n"})}),"\n",(0,i.jsx)(e.h2,{id:"migrations",children:"Migrations"}),"\n",(0,i.jsx)(e.p,{children:"Create migration files:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",children:"// migrations/002_add_status_to_users.ts\n\nexport async function up(db: DB) {\n  await db.execute(`\n    ALTER TABLE users ADD COLUMN status VARCHAR(50) DEFAULT 'active'\n  `);\n}\n\nexport async function down(db: DB) {\n  await db.execute(`\n    ALTER TABLE users DROP COLUMN status\n  `);\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:"Run migrations:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"npm run migrate:up    # Run pending migrations\nnpm run migrate:down  # Rollback last migration\nnpm run migrate:list  # Show migration status\n"})}),"\n",(0,i.jsx)(e.h2,{id:"hooks",children:"Hooks"}),"\n",(0,i.jsx)(e.p,{children:"Run custom Lua scripts on database operations:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",children:'const db = new DB(config, null, {\n  onInsert: `\n    function onInsert(table, data)\n      print("Inserted into " .. table)\n      return data\n    end\n  `,\n  onUpdate: `\n    function onUpdate(table, data)\n      print("Updated " .. table)\n      return data\n    end\n  `\n});\n'})}),"\n",(0,i.jsx)(e.h2,{id:"connection-pooling",children:"Connection Pooling"}),"\n",(0,i.jsx)(e.p,{children:"Manage connections efficiently:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",children:"const db = new DB(config);\n\ndb.setPool({\n  min: 5,\n  max: 20,\n  idleTimeoutMillis: 30000\n});\n\nawait db.connect();\n"})}),"\n",(0,i.jsx)(e.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Use migrations"})," - Track schema changes"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Index frequently queried columns"})," - Improve performance"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Validate input"})," - Prevent SQL injection"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Use transactions"})," - Maintain data integrity"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Handle errors"})," - Gracefully fail"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Close connections"})," - Prevent leaks"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Use prepared statements"})," - Safe queries"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Cache results"})," - Reduce database load"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"common-patterns",children:"Common Patterns"}),"\n",(0,i.jsx)(e.h3,{id:"user-registration",children:"User Registration"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",children:"// site/api/auth/(register).ts\n\nexport async function handle(req: IncomingMessage, res: ServerResponse) {\n  if (req.method === 'POST') {\n    const body = await readBody(req);\n    const { email, password, name } = JSON.parse(body);\n    \n    // Validate\n    if (!email || !password || !name) {\n      res.writeHead(400);\n      res.end(JSON.stringify({ error: 'Missing fields' }));\n      return;\n    }\n    \n    const db = new DB();\n    await db.connect();\n    \n    try {\n      // Check existing\n      const existing = await db.query('users', { where: { email } });\n      if (existing) {\n        res.writeHead(400);\n        res.end(JSON.stringify({ error: 'Email already exists' }));\n        return;\n      }\n      \n      // Create user\n      const user = await db.create('users', {\n        email,\n        password: hashPassword(password),\n        name\n      });\n      \n      res.writeHead(201);\n      res.end(JSON.stringify({ user }));\n    } finally {\n      await db.disconnect();\n    }\n  }\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"paginated-list",children:"Paginated List"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-typescript",children:"// site/(blog).tsx\n\nexport async function loader(ctx: LoaderContext) {\n  const page = parseInt(ctx.query.page || '1');\n  const limit = 10;\n  const offset = (page - 1) * limit;\n  \n  const db = new DB();\n  await db.connect();\n  \n  try {\n    const [posts, total] = await Promise.all([\n      db.query('posts', {\n        orderBy: { created_at: 'desc' },\n        limit,\n        offset,\n        include: { author: true }\n      }),\n      db.count('posts')\n    ]);\n    \n    return {\n      posts,\n      pagination: {\n        page,\n        limit,\n        total,\n        pages: Math.ceil(total / limit)\n      }\n    };\n  } finally {\n    await db.disconnect();\n  }\n}\n"})}),"\n",(0,i.jsx)(e.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"./api",children:"API Routes"})," - Build endpoints"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"./auth",children:"Authentication"})," - Secure your database"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"./middleware",children:"Middleware"})," - Add database middleware"]}),"\n"]})]})}function u(n={}){const{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(o,{...n})}):o(n)}},6145(n,e,s){s.d(e,{R:()=>r,x:()=>d});var t=s(7140);const i={},a=t.createContext(i);function r(n){const e=t.useContext(a);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:r(n.components),t.createElement(a.Provider,{value:e},n.children)}}}]);