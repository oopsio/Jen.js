"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[3983],{5967(e,n,i){i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"build","title":"Build System","description":"Understand how Jen.js builds your site for production.","source":"@site/docs/build.md","sourceDirName":".","slug":"/build","permalink":"/docs/build","draft":false,"unlisted":false,"editUrl":"https://github.com/kessud2021/Jen.js/tree/main/website/docs/build.md","tags":[],"version":"current","sidebarPosition":14,"frontMatter":{"sidebar_position":14},"sidebar":"docs","previous":{"title":"Plugins","permalink":"/docs/plugins"},"next":{"title":"Deployment","permalink":"/docs/deployment"}}');var l=i(5656),t=i(6145);const r={sidebar_position:14},d="Build System",o={},c=[{value:"Build Modes",id:"build-modes",level:2},{value:"SSG (Static Site Generation)",id:"ssg-static-site-generation",level:3},{value:"SSR (Server-Side Rendering)",id:"ssr-server-side-rendering",level:3},{value:"Build Process",id:"build-process",level:2},{value:"1. Route Discovery",id:"1-route-discovery",level:3},{value:"2. Bundling",id:"2-bundling",level:3},{value:"3. Rendering",id:"3-rendering",level:3},{value:"4. Optimization",id:"4-optimization",level:3},{value:"5. Output",id:"5-output",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Build Environment",id:"build-environment",level:2},{value:"Code Splitting",id:"code-splitting",level:2},{value:"Dynamic Imports",id:"dynamic-imports",level:3},{value:"Tree Shaking",id:"tree-shaking",level:2},{value:"Asset Handling",id:"asset-handling",level:2},{value:"Environment Variables",id:"environment-variables",level:2},{value:"Build Optimization",id:"build-optimization",level:2},{value:"CSS Optimization",id:"css-optimization",level:3},{value:"JavaScript Optimization",id:"javascript-optimization",level:3},{value:"Image Optimization",id:"image-optimization",level:3},{value:"Incremental Builds",id:"incremental-builds",level:2},{value:"Monitoring Build Time",id:"monitoring-build-time",level:2},{value:"Production Checklist",id:"production-checklist",level:2},{value:"Deployment Build",id:"deployment-build",level:2},{value:"Build Hooks",id:"build-hooks",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Build fails with TypeScript error",id:"build-fails-with-typescript-error",level:3},{value:"Out of memory on large builds",id:"out-of-memory-on-large-builds",level:3},{value:"Build is slow",id:"build-is-slow",level:3},{value:"Static assets not found",id:"static-assets-not-found",level:3},{value:"Next Steps",id:"next-steps",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"build-system",children:"Build System"})}),"\n",(0,l.jsx)(n.p,{children:"Understand how Jen.js builds your site for production."}),"\n",(0,l.jsx)(n.h2,{id:"build-modes",children:"Build Modes"}),"\n",(0,l.jsx)(n.h3,{id:"ssg-static-site-generation",children:"SSG (Static Site Generation)"}),"\n",(0,l.jsx)(n.p,{children:"Build entire site to static HTML at build time:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"npm run build\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Output in ",(0,l.jsx)(n.code,{children:"dist/"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"dist/\n\u251c\u2500\u2500 index.html\n\u251c\u2500\u2500 about/\n\u2502   \u2514\u2500\u2500 index.html\n\u251c\u2500\u2500 posts/\n\u2502   \u251c\u2500\u2500 1/\n\u2502   \u2502   \u2514\u2500\u2500 index.html\n\u2502   \u2514\u2500\u2500 2/\n\u2502       \u2514\u2500\u2500 index.html\n\u2514\u2500\u2500 assets/\n    \u2514\u2500\u2500 ...\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Pros:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Fast serving"}),"\n",(0,l.jsx)(n.li,{children:"Works on any static host"}),"\n",(0,l.jsx)(n.li,{children:"Great SEO"}),"\n",(0,l.jsx)(n.li,{children:"Cheap hosting"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Cons:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Slower builds"}),"\n",(0,l.jsx)(n.li,{children:"Limited dynamic routes"}),"\n",(0,l.jsx)(n.li,{children:"Need rebuild for updates"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"ssr-server-side-rendering",children:"SSR (Server-Side Rendering)"}),"\n",(0,l.jsx)(n.p,{children:"Build assets, serve pages on-demand:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"npm run build\nnpm run start\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Pros:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Instant updates"}),"\n",(0,l.jsx)(n.li,{children:"Unlimited dynamic routes"}),"\n",(0,l.jsx)(n.li,{children:"Personalized content"}),"\n",(0,l.jsx)(n.li,{children:"Real-time data"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Cons:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Slower page loads"}),"\n",(0,l.jsx)(n.li,{children:"Server required"}),"\n",(0,l.jsx)(n.li,{children:"Higher hosting cost"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"build-process",children:"Build Process"}),"\n",(0,l.jsx)(n.h3,{id:"1-route-discovery",children:"1. Route Discovery"}),"\n",(0,l.jsxs)(n.p,{children:["Jen.js scans your ",(0,l.jsx)(n.code,{children:"site/"})," directory for routes:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"site/\n\u251c\u2500\u2500 (home).tsx\n\u251c\u2500\u2500 posts/\n\u2502   \u2514\u2500\u2500 ($id).tsx\n\u2514\u2500\u2500 api/\n    \u2514\u2500\u2500 (users).ts\n"})}),"\n",(0,l.jsx)(n.p,{children:"Routes are discovered automatically."}),"\n",(0,l.jsx)(n.h3,{id:"2-bundling",children:"2. Bundling"}),"\n",(0,l.jsx)(n.p,{children:"JavaScript and CSS are bundled with esbuild:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Development (slow, readable output)\nnpm run build -- --dev\n\n# Production (optimized, minified)\nnpm run build -- --prod\n"})}),"\n",(0,l.jsx)(n.h3,{id:"3-rendering",children:"3. Rendering"}),"\n",(0,l.jsx)(n.p,{children:"For SSG, routes are rendered to static HTML:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"// Rendering engine processes each route\nexport default function Home() {\n  return <h1>Hello</h1>;\n}\n\n// \u2192 becomes \u2192 <h1>Hello</h1> in HTML\n"})}),"\n",(0,l.jsx)(n.h3,{id:"4-optimization",children:"4. Optimization"}),"\n",(0,l.jsx)(n.p,{children:"Assets are optimized:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"CSS"}),": Minified, unused styles removed"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"JavaScript"}),": Minified, dead code eliminated"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Images"}),": Compressed, resized"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"HTML"}),": Minified"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"5-output",children:"5. Output"}),"\n",(0,l.jsxs)(n.p,{children:["Final optimized files written to ",(0,l.jsx)(n.code,{children:"dist/"}),"."]}),"\n",(0,l.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,l.jsxs)(n.p,{children:["Configure build behavior in ",(0,l.jsx)(n.code,{children:"jen.config.ts"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"const config: FrameworkConfig = {\n  // Input/output directories\n  siteDir: 'site',\n  distDir: 'dist',\n  \n  // Build settings\n  build: {\n    minify: true,\n    sourcemap: false,\n    target: 'es2022'\n  },\n  \n  // Rendering\n  rendering: {\n    defaultMode: 'ssg',\n    defaultRevalidateSeconds: 3600\n  },\n  \n  // Routing\n  routes: {\n    fileExtensions: ['.tsx', '.jsx', '.ts', '.js'],\n    routeFilePattern: /^\\((.+)\\)\\.(t|j)sx?$/\n  }\n};\n\nexport default config;\n"})}),"\n",(0,l.jsx)(n.h2,{id:"build-environment",children:"Build Environment"}),"\n",(0,l.jsx)(n.p,{children:"Set environment for build:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Development build\nNODE_ENV=development npm run build\n\n# Production build\nNODE_ENV=production npm run build\n"})}),"\n",(0,l.jsx)(n.p,{children:"Detect in your code:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"export async function loader(ctx: LoaderContext) {\n  if (process.env.NODE_ENV === 'production') {\n    // Use production API\n    return await fetch('https://api.example.com/data');\n  } else {\n    // Use local API\n    return await fetch('http://localhost:3000/api/data');\n  }\n}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"code-splitting",children:"Code Splitting"}),"\n",(0,l.jsx)(n.p,{children:"Automatically split code by route:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"// Each route gets its own bundle\nsite/(home).tsx        \u2192 home.js\nsite/(about).tsx       \u2192 about.js\nsite/posts/($id).tsx   \u2192 posts.js\n"})}),"\n",(0,l.jsx)(n.h3,{id:"dynamic-imports",children:"Dynamic Imports"}),"\n",(0,l.jsx)(n.p,{children:"Lazy load components:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"import { lazy, Suspense } from 'preact';\n\nconst HeavyChart = lazy(() => import('./Chart.tsx'));\n\nexport default function Dashboard() {\n  return (\n    <Suspense fallback={<p>Loading...</p>}>\n      <HeavyChart />\n    </Suspense>\n  );\n}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"tree-shaking",children:"Tree Shaking"}),"\n",(0,l.jsx)(n.p,{children:"Remove unused code automatically:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"// lib.ts\nexport function used() { /* ... */ }\nexport function unused() { /* ... */ }\n\n// route.tsx\nimport { used } from './lib.ts';\n\nused();  // Included in bundle\n// unused() is removed\n"})}),"\n",(0,l.jsx)(n.h2,{id:"asset-handling",children:"Asset Handling"}),"\n",(0,l.jsx)(n.p,{children:"Reference static assets:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:'// Reference files in site/assets/\nexport default function Home() {\n  return (\n    <div>\n      <img src="/assets/logo.png" alt="Logo" />\n      <video src="/assets/intro.mp4" controls></video>\n    </div>\n  );\n}\n'})}),"\n",(0,l.jsxs)(n.p,{children:["Build copies assets to ",(0,l.jsx)(n.code,{children:"dist/assets/"}),"."]}),"\n",(0,l.jsx)(n.h2,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,l.jsx)(n.p,{children:"Access env vars in code:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"export async function loader(ctx: LoaderContext) {\n  const apiKey = process.env.API_KEY;\n  const baseUrl = process.env.BASE_URL || 'http://localhost:3000';\n  \n  return { apiKey, baseUrl };\n}\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Set via ",(0,l.jsx)(n.code,{children:".env"})," file:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"API_KEY=secret123\nBASE_URL=https://example.com\nDATABASE_URL=postgresql://...\n"})}),"\n",(0,l.jsx)(n.p,{children:"Or command line:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"API_KEY=secret npm run build\n"})}),"\n",(0,l.jsx)(n.h2,{id:"build-optimization",children:"Build Optimization"}),"\n",(0,l.jsx)(n.h3,{id:"css-optimization",children:"CSS Optimization"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"const config: FrameworkConfig = {\n  build: {\n    css: {\n      minify: true,\n      removeUnused: true\n    }\n  }\n};\n"})}),"\n",(0,l.jsx)(n.h3,{id:"javascript-optimization",children:"JavaScript Optimization"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"const config: FrameworkConfig = {\n  build: {\n    minify: true,\n    compress: true,\n    mangle: true\n  }\n};\n"})}),"\n",(0,l.jsx)(n.h3,{id:"image-optimization",children:"Image Optimization"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"const config: FrameworkConfig = {\n  build: {\n    images: {\n      optimized: true,\n      maxWidth: 1920\n    }\n  }\n};\n"})}),"\n",(0,l.jsx)(n.h2,{id:"incremental-builds",children:"Incremental Builds"}),"\n",(0,l.jsx)(n.p,{children:"Rebuild only changed files:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Use cache for faster rebuilds\nnpm run build -- --incremental\n"})}),"\n",(0,l.jsx)(n.h2,{id:"monitoring-build-time",children:"Monitoring Build Time"}),"\n",(0,l.jsx)(n.p,{children:"Check build performance:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"// Get build stats\nnpm run build -- --stats\n"})}),"\n",(0,l.jsx)(n.p,{children:"Output:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"Build Time: 12.3s\nRoutes: 45\nAssets: 234KB\nJS Bundle: 156KB\nCSS Bundle: 23KB\n"})}),"\n",(0,l.jsx)(n.h2,{id:"production-checklist",children:"Production Checklist"}),"\n",(0,l.jsx)(n.p,{children:"Before deploying to production:"}),"\n",(0,l.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Run TypeScript check: ",(0,l.jsx)(n.code,{children:"npm run typecheck"})]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Build succeeds: ",(0,l.jsx)(n.code,{children:"npm run build"})]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","No console errors"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","All routes work"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","API endpoints respond"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Images load correctly"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","CSS applies properly"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Database connection works"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Environment variables set"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Error pages configured"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"deployment-build",children:"Deployment Build"}),"\n",(0,l.jsx)(n.p,{children:"Generate optimized production build:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Clean previous build\nnpm run clean\n\n# Full production build\nNODE_ENV=production npm run build\n"})}),"\n",(0,l.jsx)(n.h2,{id:"build-hooks",children:"Build Hooks"}),"\n",(0,l.jsx)(n.p,{children:"Plugins can hook into build process:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"export default {\n  name: 'build-hook-plugin',\n  \n  onBuild: async (context: BuildContext) => {\n    console.log(`Building ${context.routes.length} routes`);\n    \n    // Generate additional files\n    await generateSitemap(context);\n    await generateRSSFeed(context);\n    await generateRobots(context);\n  }\n};\n"})}),"\n",(0,l.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,l.jsx)(n.h3,{id:"build-fails-with-typescript-error",children:"Build fails with TypeScript error"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"npm run typecheck\n# Fix reported errors\nnpm run build\n"})}),"\n",(0,l.jsx)(n.h3,{id:"out-of-memory-on-large-builds",children:"Out of memory on large builds"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Increase Node memory\nNODE_OPTIONS=--max-old-space-size=4096 npm run build\n"})}),"\n",(0,l.jsx)(n.h3,{id:"build-is-slow",children:"Build is slow"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Use incremental builds\nnpm run build -- --incremental\n\n# Skip source maps\nnpm run build -- --no-sourcemap\n"})}),"\n",(0,l.jsx)(n.h3,{id:"static-assets-not-found",children:"Static assets not found"}),"\n",(0,l.jsxs)(n.p,{children:["Check assets are in ",(0,l.jsx)(n.code,{children:"site/assets/"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"site/\n\u2514\u2500\u2500 assets/\n    \u251c\u2500\u2500 logo.png\n    \u2514\u2500\u2500 styles.css\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Reference as ",(0,l.jsx)(n.code,{children:"/assets/filename"}),"."]}),"\n",(0,l.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"./deployment",children:"Deployment"})," - Deploy your build"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"./performance",children:"Performance"})," - Optimize build output"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"./native-modules",children:"Native Modules"})," - Compile Rust code"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(a,{...e})}):a(e)}},6145(e,n,i){i.d(n,{R:()=>r,x:()=>d});var s=i(7140);const l={},t=s.createContext(l);function r(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);