"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[3407],{6145(e,n,r){r.d(n,{R:()=>o,x:()=>a});var s=r(7140);const t={},i=s.createContext(t);function o(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(i.Provider,{value:n},e.children)}},7276(e,n,r){r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"auth","title":"Authentication","description":"Implement user authentication with JWT tokens in Jen.js.","source":"@site/docs/auth.md","sourceDirName":".","slug":"/auth","permalink":"/docs/auth","draft":false,"unlisted":false,"editUrl":"https://github.com/kessud2021/Jen.js/tree/main/website/docs/auth.md","tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"sidebar_position":10},"sidebar":"docs","previous":{"title":"Database","permalink":"/docs/database"},"next":{"title":"Middleware","permalink":"/docs/middleware"}}');var t=r(5656),i=r(6145);const o={sidebar_position:10},a="Authentication",d={},c=[{value:"JWT Overview",id:"jwt-overview",level:2},{value:"Token Structure",id:"token-structure",level:3},{value:"Signing Tokens",id:"signing-tokens",level:2},{value:"Verifying Tokens",id:"verifying-tokens",level:2},{value:"Login Endpoint",id:"login-endpoint",level:2},{value:"Protected Routes",id:"protected-routes",level:2},{value:"Register Endpoint",id:"register-endpoint",level:2},{value:"Protected Pages",id:"protected-pages",level:2},{value:"Client-Side Auth",id:"client-side-auth",level:2},{value:"Logout",id:"logout",level:2},{value:"Password Hashing",id:"password-hashing",level:2},{value:"Role-Based Access Control (RBAC)",id:"role-based-access-control-rbac",level:2},{value:"Session Management",id:"session-management",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Security Headers",id:"security-headers",level:2},{value:"Next Steps",id:"next-steps",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"authentication",children:"Authentication"})}),"\n",(0,t.jsx)(n.p,{children:"Implement user authentication with JWT tokens in Jen.js."}),"\n",(0,t.jsx)(n.h2,{id:"jwt-overview",children:"JWT Overview"}),"\n",(0,t.jsx)(n.p,{children:"JWT (JSON Web Tokens) provide stateless authentication. Tokens contain encoded user data and are signed for security."}),"\n",(0,t.jsx)(n.h3,{id:"token-structure",children:"Token Structure"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'header.payload.signature\n\n{\n  "alg": "HS256",\n  "typ": "JWT"\n}.{\n  "userId": 123,\n  "email": "user@example.com",\n  "iat": 1516239022,\n  "exp": 1516325422\n}.SIGNATURE\n'})}),"\n",(0,t.jsx)(n.h2,{id:"signing-tokens",children:"Signing Tokens"}),"\n",(0,t.jsx)(n.p,{children:"Create and sign JWT tokens:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { signToken } from '@src/auth/jwt';\n\nconst token = signToken(\n  { userId: 123, email: 'user@example.com' },\n  '7d'  // Expires in 7 days\n);\n\nconsole.log(token);\n// eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\n"})}),"\n",(0,t.jsx)(n.h2,{id:"verifying-tokens",children:"Verifying Tokens"}),"\n",(0,t.jsx)(n.p,{children:"Verify and decode tokens:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { verifyToken } from '@src/auth/jwt';\n\ntry {\n  const payload = verifyToken(token);\n  console.log(payload);  // { userId: 123, email: 'user@example.com' }\n} catch (error) {\n  console.error('Invalid token');\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"login-endpoint",children:"Login Endpoint"}),"\n",(0,t.jsx)(n.p,{children:"Create a login API route:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// site/api/auth/(login).ts\n\nimport { signToken } from '@src/auth/jwt';\nimport { DB } from '@src/db';\n\nexport async function handle(req: IncomingMessage, res: ServerResponse) {\n  if (req.method !== 'POST') {\n    res.writeHead(405);\n    res.end();\n    return;\n  }\n  \n  const body = await readBody(req);\n  const { email, password } = JSON.parse(body);\n  \n  // Validate input\n  if (!email || !password) {\n    res.writeHead(400);\n    res.end(JSON.stringify({ error: 'Email and password required' }));\n    return;\n  }\n  \n  const db = new DB();\n  await db.connect();\n  \n  try {\n    // Find user\n    const user = await db.query('users', { where: { email } });\n    \n    if (!user || !verifyPassword(password, user.password)) {\n      res.writeHead(401);\n      res.end(JSON.stringify({ error: 'Invalid credentials' }));\n      return;\n    }\n    \n    // Sign token\n    const token = signToken(\n      { userId: user.id, email: user.email },\n      '7d'\n    );\n    \n    res.writeHead(200, { 'content-type': 'application/json' });\n    res.end(JSON.stringify({ token, user: { id: user.id, email: user.email } }));\n  } finally {\n    await db.disconnect();\n  }\n}\n\nasync function readBody(req: IncomingMessage): Promise<string> {\n  return new Promise((resolve, reject) => {\n    let data = '';\n    req.on('data', chunk => (data += chunk));\n    req.on('end', () => resolve(data));\n    req.on('error', reject);\n  });\n}\n\nfunction verifyPassword(plain: string, hashed: string): boolean {\n  // Use bcrypt or similar in production\n  return plain === hashed;  // Placeholder\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"protected-routes",children:"Protected Routes"}),"\n",(0,t.jsx)(n.p,{children:"Check authorization in routes:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// site/api/(profile).ts\n\nimport { verifyToken } from '@src/auth/jwt';\n\nexport async function handle(req: IncomingMessage, res: ServerResponse) {\n  const authHeader = req.headers['authorization'];\n  \n  if (!authHeader) {\n    res.writeHead(401);\n    res.end(JSON.stringify({ error: 'Missing authorization header' }));\n    return;\n  }\n  \n  try {\n    const token = authHeader.replace('Bearer ', '');\n    const { userId } = verifyToken(token);\n    \n    // User is authenticated\n    const user = await getUser(userId);\n    \n    res.writeHead(200, { 'content-type': 'application/json' });\n    res.end(JSON.stringify(user));\n  } catch (error) {\n    res.writeHead(403);\n    res.end(JSON.stringify({ error: 'Invalid token' }));\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"register-endpoint",children:"Register Endpoint"}),"\n",(0,t.jsx)(n.p,{children:"Create a registration API route:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// site/api/auth/(register).ts\n\nimport { signToken } from '@src/auth/jwt';\nimport { DB } from '@src/db';\nimport { hashPassword } from '@src/shared/crypto';\n\nexport async function handle(req: IncomingMessage, res: ServerResponse) {\n  if (req.method !== 'POST') {\n    res.writeHead(405);\n    res.end();\n    return;\n  }\n  \n  const body = await readBody(req);\n  const { email, password, name } = JSON.parse(body);\n  \n  // Validate input\n  if (!email || !password || !name) {\n    res.writeHead(400);\n    res.end(JSON.stringify({ error: 'All fields required' }));\n    return;\n  }\n  \n  if (password.length < 8) {\n    res.writeHead(400);\n    res.end(JSON.stringify({ error: 'Password must be 8+ characters' }));\n    return;\n  }\n  \n  const db = new DB();\n  await db.connect();\n  \n  try {\n    // Check if email exists\n    const existing = await db.query('users', { where: { email } });\n    if (existing) {\n      res.writeHead(400);\n      res.end(JSON.stringify({ error: 'Email already registered' }));\n      return;\n    }\n    \n    // Create user\n    const user = await db.create('users', {\n      email,\n      password: await hashPassword(password),\n      name\n    });\n    \n    // Sign token\n    const token = signToken({ userId: user.id, email: user.email }, '7d');\n    \n    res.writeHead(201, { 'content-type': 'application/json' });\n    res.end(JSON.stringify({ \n      token, \n      user: { id: user.id, email: user.email, name: user.name } \n    }));\n  } finally {\n    await db.disconnect();\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"protected-pages",children:"Protected Pages"}),"\n",(0,t.jsx)(n.p,{children:"Load user data in page loaders:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// site/(dashboard).tsx\n\nimport { verifyToken } from '@src/auth/jwt';\nimport type { LoaderContext } from '@src/core/types';\n\nexport async function loader(ctx: LoaderContext) {\n  const token = extractToken(ctx.req);\n  \n  if (!token) {\n    return { notFound: true };  // Redirect to login\n  }\n  \n  try {\n    const { userId } = verifyToken(token);\n    const user = await getUser(userId);\n    \n    return { user };\n  } catch (error) {\n    return { notFound: true };\n  }\n}\n\nexport default function Dashboard({ data }: any) {\n  if (!data.user) {\n    return <p>Please login first</p>;\n  }\n  \n  return (\n    <div>\n      <h1>Welcome, {data.user.name}</h1>\n      <p>Email: {data.user.email}</p>\n    </div>\n  );\n}\n\nfunction extractToken(req: any): string | null {\n  const authHeader = req?.headers['authorization'];\n  return authHeader?.replace('Bearer ', '') || null;\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"client-side-auth",children:"Client-Side Auth"}),"\n",(0,t.jsx)(n.p,{children:"Store and use tokens in the browser:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// site/components/LoginForm.tsx\n\nimport { useState } from 'preact/hooks';\n\nexport default function LoginForm() {\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [error, setError] = useState('');\n  \n  const handleSubmit = async (e: Event) => {\n    e.preventDefault();\n    \n    try {\n      const res = await fetch('/api/auth/login', {\n        method: 'POST',\n        headers: { 'content-type': 'application/json' },\n        body: JSON.stringify({ email, password })\n      });\n      \n      const { token, user } = await res.json();\n      \n      if (res.ok) {\n        // Store token\n        localStorage.setItem('auth_token', token);\n        \n        // Store user info\n        localStorage.setItem('user', JSON.stringify(user));\n        \n        // Redirect\n        window.location.href = '/dashboard';\n      } else {\n        setError(error);\n      }\n    } catch (err) {\n      setError('Login failed');\n    }\n  };\n  \n  return (\n    <form onSubmit={handleSubmit}>\n      <input\n        type=\"email\"\n        value={email}\n        onChange={(e) => setEmail(e.target.value)}\n        placeholder=\"Email\"\n        required\n      />\n      <input\n        type=\"password\"\n        value={password}\n        onChange={(e) => setPassword(e.target.value)}\n        placeholder=\"Password\"\n        required\n      />\n      {error && <p style={{ color: 'red' }}>{error}</p>}\n      <button type=\"submit\">Login</button>\n    </form>\n  );\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"logout",children:"Logout"}),"\n",(0,t.jsx)(n.p,{children:"Clear authentication:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// site/api/auth/(logout).ts\n\nexport async function handle(req: IncomingMessage, res: ServerResponse) {\n  // Client-side logout with localStorage\n  res.writeHead(200, { 'content-type': 'application/json' });\n  res.end(JSON.stringify({ success: true }));\n}\n\n// Client-side\nfunction logout() {\n  localStorage.removeItem('auth_token');\n  localStorage.removeItem('user');\n  window.location.href = '/login';\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"password-hashing",children:"Password Hashing"}),"\n",(0,t.jsx)(n.p,{children:"Use bcrypt for secure password storage:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm install bcrypt\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import * as bcrypt from 'bcrypt';\n\nexport async function hashPassword(password: string): Promise<string> {\n  return await bcrypt.hash(password, 10);\n}\n\nexport async function verifyPassword(password: string, hash: string): Promise<boolean> {\n  return await bcrypt.compare(password, hash);\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"role-based-access-control-rbac",children:"Role-Based Access Control (RBAC)"}),"\n",(0,t.jsx)(n.p,{children:"Control access based on user roles:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// site/api/admin/(users).ts\n\nimport { verifyToken } from '@src/auth/jwt';\nimport { DB } from '@src/db';\n\nexport async function handle(req: IncomingMessage, res: ServerResponse) {\n  const token = extractToken(req);\n  \n  if (!token) {\n    res.writeHead(401);\n    res.end();\n    return;\n  }\n  \n  try {\n    const { userId } = verifyToken(token);\n    \n    // Check user role\n    const db = new DB();\n    await db.connect();\n    const user = await db.query('users', { where: { id: userId } });\n    await db.disconnect();\n    \n    if (user.role !== 'admin') {\n      res.writeHead(403);\n      res.end(JSON.stringify({ error: 'Admin access required' }));\n      return;\n    }\n    \n    // Handle admin request\n    const users = await getAllUsers();\n    res.writeHead(200, { 'content-type': 'application/json' });\n    res.end(JSON.stringify(users));\n  } catch (error) {\n    res.writeHead(403);\n    res.end();\n  }\n}\n\nfunction extractToken(req: IncomingMessage): string | null {\n  const authHeader = req.headers['authorization'];\n  return authHeader?.split(' ')[1] || null;\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"session-management",children:"Session Management"}),"\n",(0,t.jsx)(n.p,{children:"Track active sessions:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// site/api/auth/(me).ts\n\nimport { verifyToken } from '@src/auth/jwt';\nimport { DB } from '@src/db';\n\nexport async function handle(req: IncomingMessage, res: ServerResponse) {\n  const token = extractToken(req);\n  \n  if (!token) {\n    res.writeHead(401);\n    res.end();\n    return;\n  }\n  \n  try {\n    const { userId, iat, exp } = verifyToken(token);\n    \n    const db = new DB();\n    await db.connect();\n    const user = await db.query('users', { where: { id: userId } });\n    await db.disconnect();\n    \n    res.writeHead(200, { 'content-type': 'application/json' });\n    res.end(JSON.stringify({\n      user,\n      expiresIn: exp - Math.floor(Date.now() / 1000)\n    }));\n  } catch (error) {\n    res.writeHead(403);\n    res.end();\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Use HTTPS"})," - Never send tokens over HTTP"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Store tokens securely"})," - Use httpOnly cookies if possible"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Set expiration"})," - Use short-lived tokens (7-30 days)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Validate thoroughly"})," - Check all inputs"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Hash passwords"})," - Use bcrypt or Argon2"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Rotate secrets"})," - Change signing keys periodically"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Implement refresh tokens"})," - Allow token renewal"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Log authentication events"})," - Track login/logout"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Rate limit auth endpoints"})," - Prevent brute force attacks"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Use CORS properly"})," - Restrict token access"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"security-headers",children:"Security Headers"}),"\n",(0,t.jsx)(n.p,{children:"Add security headers to your routes:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'export function Head() {\n  return (\n    <>\n      <meta httpEquiv="x-ua-compatible" content="ie=edge" />\n      <meta httpEquiv="x-content-type-options" content="nosniff" />\n      <meta httpEquiv="x-frame-options" content="DENY" />\n    </>\n  );\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"./api",children:"API Routes"})," - Build authentication endpoints"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"./database",children:"Database"})," - Store user data"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"./middleware",children:"Middleware"})," - Add auth middleware"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}}}]);